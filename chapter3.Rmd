---
title: "Chapter 3 - The Student Alcohol Consumption Dataset - Visualization and Analysis"
author: "Gyan Dookie"
date: "10 February 2017"
output: html_document
---

## Chapter 3 - The Student Alcohol Consumption Dataset - Visualization and Analysis


### 1. Read the data into R

```{r, echo = FALSE, message=FALSE, warning=FALSE}
### Install the packages which are needed
### install.packages("ggplot2")
library(ggplot2)

### install.packages("GGally")
library(GGally)
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
### Load in the dplyr library that has many usefule functions for data wrangling
library(dplyr)
```

Here we read the joined student alcohol consumption data into R ( *Remember that the path to the .csv file must be relative in order for it to work on the remote server!*).
```{r, echo=TRUE, results='hide'}

alc <- read.table("data/alc_mod.csv", header= TRUE, sep=",")
alc_orig <- alc
```
### 2. Preliminary explorations of the data
The combined dataset's 35 variables are shown below and it has altogether 382 observations (rows)
```{r, echo=FALSE}
colnames(alc)
dim(alc)
### str(alc)
```
The data includes the following variable datatypes: factorial, integer, numeric and logical.
I used the pipe symbol to provide the output of the head()-function (prints out the observations according to the given second parameter) to the str()-function that shows the structure of the data.
```{r, echo=TRUE}
head(alc, 0) %>% str()
```
### 3. My personal hypothesis of the relationships between high/low alcohol usage and 4 other variables
Next I'm gonna present my hypothesis of the relationships between high/low alcohol use and four other variables I chose from the data: sex, study time, internet use and the final grade for the course

* **Sex vs. high/low alcohol use**
    * I believe that the male gender uses more alcohol than the female gender. I base this assumption on cultural aspects. The survey was conducted in Portugal where the gender roles are, I assume, more traditional and conservative than in Finland. I think (in Portugal) there's more social pressure towards women to "behave" and not be shown drunk in the public than towars men. My hypothesis is that here is a strong positive correlation between the male gender and high alcohol use.
    
* **Study time vs. high/low alcohol use**
    * My hypothesis here is based on a simple assumption. The more you use alcohol, the more you are doing something else than studying (i.e. hanging out in the bar with your friends). And let's face it, if you are drunk, it is quite difficult to study. That said, my hypothesis is that study time is negatively correlated to high alcohol use.
    
* **Internet use vs. high/low alcohol use**
    * This relationship is not so easy to hypothesize. I just assumed above that when you're using alcohol, you are likely to hang out with your friends. It would be also difficult to concentrate on cognitively challenging tasks. The mobile internet usage could be a game changer here, because many younger people nowadays use internet all the time through the mobile devices (e.g. when hanging out with their friends). Nevertheless, the survey's factorial internet variable means the internet at home. That being the case, internet connection only at home might reduce hanging out and so the use of alcohol. There's also a psychological point that could affect this relationship. High alcohol use and high internet use might be a sign that the person is oriented towards crossing virtual, technological, social and psychological "borders"" and exploring the unknown. The former (you don't hangout because your at home using your internet connection) and the latter (heavy internet and alcohol users have the same kind of "crossing borders" mindset) seem to cancel each other out. So my hypothesis is that there is a close to zero correlation between high internet use and high alcohol consumption.
    
* **Final course grade vs. high alcohol consumption**
      * Moderate alcohol use usually predicts longer life than no alcohol use, so there's some connection, I guess,  between the former and cognitive stamina. Nevertheless my hypothesis here is that high alcohol consumption results in lower final course grades. If you drink too much you will likely have more school absences and you will not be able to concentrate on cognitively challenging things. The correlation here would be negative and statistically significant
      
### 4. Exploring the distributions of my chosen variables numerically and graphically
#### 4.1 **Sex and High alchol use vs. Final grade**
Producing summary statistics by group
```{r, echo=FALSE}
alc1 <- alc %>% group_by(sex, high_use) %>% summarise(count = n(), mean_grade= mean(G3))
alc1
```

Drawing box plots

```{r, echo=FALSE}
## From the barplot below we can see, that high alcohol use and sex are connected
ggplot(alc_orig, aes(x= high_use, fill=high_use)) + geom_bar() + facet_grid(. ~ sex) + ggtitle("Sex vs high alcohol use") + ylab("The number of cases") + xlab("High alcohol usage") + guides(fill=guide_legend(title=""))

# initialize a plot of high_use and G3
g1 <- ggplot(alc, aes(x = high_use, y = G3, col=sex))

# define the plot as a boxplot and draw it
g1 + geom_boxplot() + ylab("Final grade")
#g1 <- ggplot(alc, aes(x = high_use, y = G3, col=sex))
#g1 + geom_boxplot() + ylab("grade")
# initialise a plot of high_use and absences
#g2 <- ggplot(alc, aes(x = high_use, y = absences, col=sex)) 
#g2 <- g2 + geom_boxplot() + ylab("absences")
#g2
# define the plot as a boxplot and draw it
#g2 + ggtitle("Student absences by alcohol consumption and sex")


ggplot(alc_orig, aes(x= factor(high_use), y=G3)) + geom_point() + facet_grid(. ~ sex) + stat_smooth(method="lm", col="red") + ggtitle("Final grade vs. high alcohol use") + ylab("Final grade") + xlab("High alcohol usage")

ggplot(alc_orig, aes(x= G3, y=factor(high_use))) + geom_point() + facet_grid(. ~ sex) + stat_smooth(method="lm", col="red") + ggtitle("Final grade vs. high alcohol use") 




```



#### 4.2 **Internet use and High alchol use vs. Final grade**
Producing summary statistics by group
```{r, echo=FALSE}
alc2 <- alc %>% group_by(internet, high_use) %>% summarise(count = n(), mean_grade= mean(G3))
alc2
```

**Visualization**

```{r, echo=FALSE}

## From the barplot below we can see, that internet at home doesn't affect alcohol usage
ggplot(alc_orig, aes(x= internet, fill=high_use)) + geom_bar() + facet_grid(. ~ sex) + ggtitle("Internet at home vs. high alcohol use") + ylab("The number of cases") + xlab("Internet at home")

# initialize a plot of high_use and G3
g1 <- ggplot(alc, aes(x = high_use, y = G3, col=internet))

# define the plot as a boxplot and draw it
g1 + geom_boxplot() + ylab("Final grade") + xlab("High alcohol usage")
#g1 <- ggplot(alc, aes(x = high_use, y = G3, col=sex))
#g1 + geom_boxplot() + ylab("grade")
# initialise a plot of high_use and absences
#g2 <- ggplot(alc, aes(x = high_use, y = absences, col=sex)) 
#g2 <- g2 + geom_boxplot() + ylab("absences")
#g2
# define the plot as a boxplot and draw it
#g2 + ggtitle("Student absences by alcohol consumption and sex")
```

#### 4.3 **Study time and High alchol use vs. Final grade**
Producing summary statistics by group
```{r, echo=FALSE}
alc3 <- alc %>% group_by(studytime, high_use) %>% summarise(count = n(), mean_grade= mean(G3))
alc3
```
**Visualization**

The barplot below indicates that higher studytimes use means lower alcohol usage.

```{r, echo=FALSE}
## From the barplot below we can see, that internet at home doesn't affect alcohol usage
ggplot(alc_orig, aes(x= studytime, fill=high_use)) + geom_bar() + facet_grid(. ~ sex) + ggtitle("Studytime vs. high alcohol use") + xlab("Studytime") + ylab("The number of cases")
```

```{r, echo=FALSE}

```

### 5. Exploring the relationship between my chosen variables and the binary high/low alcohol consumption variable with logistic regression
#### 5.1 The summary and the coefficients of the model
Next we'll use glm() to *fit a logistic regression model* with high_use as the target variable and sex, internet, studytime and the final grade (G3) as the predictors. Then we'll print out **the summary of the model** and finally **the coefficients of the model**.

*The summary of the model*
```{r, echo=FALSE, message= FALSE}
# find the model with glm()
m <- glm(high_use ~ sex + internet + studytime + G3, data = alc, family = "binomial")
summary(m)
```
*The coefficients of the model*
```{r, echo=FALSE}
coef(m)
```
#### 5.2 Computing the odd ratios of the coefficients and providing the confidence intervals for them
The computational target variable in the logistic regression model is the log of odds. That is why the exponents of the coefficients of a logistic regression model can be interpret as odds ratios between a unit change (vs no change) in the corresponding explanatory variable.
```{r, echo=FALSE}
OR <- coef(m) %>% exp
OR
CI <- confint(m)%>% exp
```
Let's print out the odd ratios binded together with their confidence intervals!
```{r, echo=FALSE, message=FALSE, warning=FALSE}
cbind(OR, CI)
```
### 6. Exploring the predictive power of the model
Of my chosen variables, sex and studytime had a statistical relationship with low/high alcohol consumption. Next we'll explore the predictive power of the created model using these variables.
```{r, echo=FALSE}
# fit the model
m2 <- glm(high_use ~ sex+ studytime, data = alc, family = "binomial")
# predict() the probability of high_use
probabilities <- predict(m2, type = "response")
# add the predicted probabilities to 'alc'
alc <- mutate(alc, probability = probabilities)
# use the probabilities to make a prediction of high_use
alc <- mutate(alc, prediction = probability>0.5)
# tabulate the target variable versus the predictions
table(high_use = alc$high_use, prediction = alc$prediction)
dim(alc)
pratio <- (268*100/382)
pratio
#alc

# initialize a plot of 'high_use' versus 'probability' in 'alc'
#g <- ggplot(alc, aes(x = probability, y = high_use, col=prediction))

# define the geom as points and draw the plot
#g + geom_point()
# tabulate the target variable versus the predictions
table(high_use = alc$high_use, prediction = alc$prediction) %>% prop.table()%>%addmargins() 
```
**Conclusions**

* The model predicted the target variable with a 70 % strength / 0.7 probability, which is an ok, but not an excellent result
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

